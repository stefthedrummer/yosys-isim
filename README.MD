# YOSYS-iSim - an Interactive-Verilog-Simulator

### ... for Javascript/Typescript and Rust

This project tries to implement `an interactive` simulator that can simulate netlists produced by Yosys (https://github.com/YosysHQ/yosys)

it will read modules from the netlist.json that can be generated with Yosys via the **write_json** command.

### Project Structure:

- `**yosys_isim/**`: the core library that implements the simulator and the json parser
- `**yosys_isim_test/**`: end to end tests. compiles SystemVerilog via yosys, parses it and runs simulation tests.
- `**yosys_isim_napi/**`: js/ts/node bindings

## Javascript / Typescript

```javascript
const modules = Module.parseModulesFromFile("<netlist.json>")
const module = modules.find(e => e.name == "And")!!;
const sim = Sim.create(module);

sim.set("a", [1])
sim.set("b", [1])
sim.simulate(); // simulates 1 tick
console.log(sim.get("b", 1))
```

## Rust

```rust
let module = TEST_GATES_SV.deref().iter().find_by_name("Dff")?;

let mut sim: Sim<'_> = Sim::new(&module);
let port_c = sim.get_port::<1>("c")?;
let port_d = sim.get_port::<2>("d")?;
let port_q = sim.get_port::<2>("q")?;

assert_eq!(sim.get(&port_q), [Logic::X; 2]);

sim.set(&port_c, [0]);
sim.set(&port_d, [1, 0]);
sim.simulate()?; // simulates 1 tick

assert_eq!(sim.get(&port_q), [Logic::X; 2]);

sim.set(&port_c, [1]);
sim.simulate()?;

assert_eq!(sim.get(&port_q), [Logic::_1, Logic::_0]);

sim.set(&port_c, [0]);
sim.set(&port_d, [0, 1]);
sim.simulate()?;

sim.set(&port_c, [1]);
sim.simulate()?;

assert_eq!(sim.get(&port_q), [Logic::_0, Logic::_1]);
```

### Features :

Implementing `Gate-Level-Cells` is actually not hard, since their logic gets mostly auto generated.
For the AND gate - for instance - we define the behavour just for the logic states `0` and `1`. Then the simulator creates a `Truth-Table` automatically including the `X` state.


|                                |                  |
| ------------------------------ | ---------------- |
| Basic Logic Gates, FlipFlops   | ‚úÖ               |
| Low-Level Gates ($_XNOR_, ...) | üü° (some)        |
| Tests                          | üü° (only simple) |
| Outputs, Dumps, Traces         | ‚ùå               |

| Combinatorial cells (simple) | ‚òê   |
| ---------------------------- | --- |
| $_AND_                       | ‚úÖ  |
| $_BUF_                       | ‚òê   |
| $_MUX_                       | ‚òê   |
| $_NAND_                      | ‚úÖ  |
| $_NOR_                       | ‚úÖ  |
| $_NOT_                       | ‚úÖ  |
| $_OR_                        | ‚úÖ  |
| $_XNOR_                      | ‚úÖ  |
| $_XOR_                       | ‚úÖ  |

| Combinatorial cells (combined) | ‚òê   |
| ------------------------------ | --- |
| $_ANDNOT_                      | ‚úÖ  |
| $_AOI3_                        | ‚úÖ  |
| $_AOI4_                        | ‚òê   |
| $_MUX16_                       | ‚òê   |
| $_MUX4_                        | ‚òê   |
| $_MUX8_                        | ‚òê   |
| $_NMUX_                        | ‚òê   |
| $_OAI3_                        | ‚úÖ  |
| $_OAI4_                        | ‚òê   |
| $_ORNOT_                       | ‚úÖ  |

| Flip-flop cells | ‚òê   |
| --------------- | --- |
| $_ALDFFE_NNN_   | ‚òê   |
| $_ALDFFE_NNP_   | ‚òê   |
| $_ALDFFE_NPN_   | ‚òê   |
| $_ALDFFE_NPP_   | ‚òê   |
| $_ALDFFE_PNN_   | ‚òê   |
| $_ALDFFE_PNP_   | ‚òê   |
| $_ALDFFE_PPN_   | ‚òê   |
| $_ALDFFE_PPP_   | ‚òê   |
| $_ALDFF_NN_     | ‚òê   |
| $_ALDFF_NP_     | ‚òê   |
| $_ALDFF_PN_     | ‚òê   |
| $_ALDFF_PP_     | ‚òê   |
| $_DFFE_NN0N_    | ‚òê   |
| $_DFFE_NN0P_    | ‚òê   |
| $_DFFE_NN1N_    | ‚òê   |
| $_DFFE_NN1P_    | ‚òê   |
| $_DFFE_NN_      | ‚òê   |
| $_DFFE_NP0N_    | ‚òê   |
| $_DFFE_NP0P_    | ‚òê   |
| $_DFFE_NP1N_    | ‚òê   |
| $_DFFE_NP1P_    | ‚òê   |
| $_DFFE_NP_      | ‚òê   |
| $_DFFE_PN0N_    | ‚òê   |
| $_DFFE_PN0P_    | ‚òê   |
| $_DFFE_PN1N_    | ‚òê   |
| $_DFFE_PN1P_    | ‚òê   |
| $_DFFE_PN_      | ‚òê   |
| $_DFFE_PP0N_    | ‚òê   |
| $_DFFE_PP0P_    | ‚òê   |
| $_DFFE_PP1N_    | ‚òê   |
| $_DFFE_PP1P_    | ‚òê   |
| $_DFFE_PP_      | ‚òê   |
| $_DFFSRE_NNNN_  | ‚òê   |
| $_DFFSRE_NNNP_  | ‚òê   |
| $_DFFSRE_NNPN_  | ‚òê   |
| $_DFFSRE_NNPP_  | ‚òê   |
| $_DFFSRE_NPNN_  | ‚òê   |
| $_DFFSRE_NPNP_  | ‚òê   |
| $_DFFSRE_NPPN_  | ‚òê   |
| $_DFFSRE_NPPP_  | ‚òê   |
| $_DFFSRE_PNNN_  | ‚òê   |
| $_DFFSRE_PNNP_  | ‚òê   |
| $_DFFSRE_PNPN_  | ‚òê   |
| $_DFFSRE_PNPP_  | ‚òê   |
| $_DFFSRE_PPNN_  | ‚òê   |
| $_DFFSRE_PPNP_  | ‚òê   |
| $_DFFSRE_PPPN_  | ‚òê   |
| $_DFFSRE_PPPP_  | ‚òê   |
| $_DFFSR_NNN_    | ‚òê   |
| $_DFFSR_NNP_    | ‚òê   |
| $_DFFSR_NPN_    | ‚òê   |
| $_DFFSR_NPP_    | ‚òê   |
| $_DFFSR_PNN_    | ‚òê   |
| $_DFFSR_PNP_    | ‚òê   |
| $_DFFSR_PPN_    | ‚òê   |
| $_DFFSR_PPP_    | ‚òê   |
| $_DFF_NN0_      | ‚òê   |
| $_DFF_NN1_      | ‚òê   |
| $_DFF_NP0_      | ‚òê   |
| $_DFF_NP1_      | ‚òê   |
| $_DFF_N_        | ‚òê   |
| $_DFF_PN0_      | ‚òê   |
| $_DFF_PN1_      | ‚òê   |
| $_DFF_PP0_      | ‚òê   |
| $_DFF_PP1_      | ‚òê   |
| $_DFF_P_        | ‚úÖ  |
| $_FF_           | ‚òê   |
| $_SDFFCE_NN0N_  | ‚òê   |
| $_SDFFCE_NN0P_  | ‚òê   |
| $_SDFFCE_NN1N_  | ‚òê   |
| $_SDFFCE_NN1P_  | ‚òê   |
| $_SDFFCE_NP0N_  | ‚òê   |
| $_SDFFCE_NP0P_  | ‚òê   |
| $_SDFFCE_NP1N_  | ‚òê   |
| $_SDFFCE_NP1P_  | ‚òê   |
| $_SDFFCE_PN0N_  | ‚òê   |
| $_SDFFCE_PN0P_  | ‚òê   |
| $_SDFFCE_PN1N_  | ‚òê   |
| $_SDFFCE_PN1P_  | ‚òê   |
| $_SDFFCE_PP0N_  | ‚òê   |
| $_SDFFCE_PP0P_  | ‚òê   |
| $_SDFFCE_PP1N_  | ‚òê   |
| $_SDFFCE_PP1P_  | ‚òê   |
| $_SDFFE_NN0N_   | ‚òê   |
| $_SDFFE_NN0P_   | ‚òê   |
| $_SDFFE_NN1N_   | ‚òê   |
| $_SDFFE_NN1P_   | ‚òê   |
| $_SDFFE_NP0N_   | ‚òê   |
| $_SDFFE_NP0P_   | ‚òê   |
| $_SDFFE_NP1N_   | ‚òê   |
| $_SDFFE_NP1P_   | ‚òê   |
| $_SDFFE_PN0N_   | ‚òê   |
| $_SDFFE_PN0P_   | ‚òê   |
| $_SDFFE_PN1N_   | ‚òê   |
| $_SDFFE_PN1P_   | ‚òê   |
| $_SDFFE_PP0N_   | ‚òê   |
| $_SDFFE_PP0P_   | ‚òê   |
| $_SDFFE_PP1N_   | ‚òê   |
| $_SDFFE_PP1P_   | ‚òê   |
| $_SDFF_NN0_     | ‚òê   |
| $_SDFF_NN1_     | ‚òê   |
| $_SDFF_NP0_     | ‚òê   |
| $_SDFF_NP1_     | ‚òê   |
| $_SDFF_PN0_     | ‚òê   |
| $_SDFF_PN1_     | ‚òê   |
| $_SDFF_PP0_     | ‚òê   |
| $_SDFF_PP1_     | ‚òê   |

| Latch cells     | ‚òê   |
| --------------- | --- |
| $_DLATCHSR_NNN_ | ‚òê   |
| $_DLATCHSR_NNP_ | ‚òê   |
| $_DLATCHSR_NPN_ | ‚òê   |
| $_DLATCHSR_NPP_ | ‚òê   |
| $_DLATCHSR_PNN_ | ‚òê   |
| $_DLATCHSR_PNP_ | ‚òê   |
| $_DLATCHSR_PPN_ | ‚òê   |
| $_DLATCHSR_PPP_ | ‚òê   |
| $_DLATCH_NN0_   | ‚òê   |
| $_DLATCH_NN1_   | ‚òê   |
| $_DLATCH_NP0_   | ‚òê   |
| $_DLATCH_NP1_   | ‚òê   |
| $_DLATCH_N_     | ‚òê   |
| $_DLATCH_PN0_   | ‚òê   |
| $_DLATCH_PN1_   | ‚òê   |
| $_DLATCH_PP0_   | ‚òê   |
| $_DLATCH_PP1_   | ‚òê   |
| $_DLATCH_P_     | ‚òê   |
| $_SR_NN_        | ‚òê   |
| $_SR_NP_        | ‚òê   |
| $_SR_PN_        | ‚òê   |
| $_SR_PP_        | ‚òê   |
